<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ichancy wheel</title>

<style>
body {
  background: #0f1724;
  color: white;
  font-family: sans-serif;
  text-align: center;
  margin: 0;
  padding-top: 40px;
}

#wheel-container {
  position: relative;
  width: 300px;
  height: 300px;
  margin: auto;
}

#wheel {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  transition: transform 4s cubic-bezier(.17,.67,.12,1);
}

#pointer {
  position: absolute;
  top: -12px;
  left: 50%;
  transform: translateX(-50%);
  width: 45px;
}

button {
  margin-top: 20px;
  padding: 12px 20px;
  background: #06b6d4;
  border: none;
  border-radius: 8px;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
}

#msg {
  margin-top: 15px;
  font-size: 16px;
}
</style>
</head>

<body>

<div id="wheel-container">
  <img id="wheel" src="wheel.png">
  <img id="pointer" src="pointer.png">
</div>

<button id="spinBtn">لديك تدويرة مجانية</button>
<div id="msg"></div>

<script>
const tg = window.Telegram?.WebApp || null;
const user = tg?.initDataUnsafe?.user || {};
const user_id = user.id || null;

// زاوية HARD LUCK من الصورة = 225 درجة
const HARD_LUCK_ANGLE = 225;

let spinning = false;

function canSpin() {
  const key = "ichancy_last_spin_" + user_id;
  const last = localStorage.getItem(key);
  if (!last) return true;
  return (Date.now() - Number(last)) >= 24*3600*1000;
}

function setSpinTime() {
  const key = "ichancy_last_spin_" + user_id;
  localStorage.setItem(key, String(Date.now()));
}

document.getElementById("spinBtn").onclick = () => {
  if (spinning) return;

  if (!canSpin()) {
    const key = "ichancy_last_spin_" + user_id;
    const last = Number(localStorage.getItem(key));
    const remain = Math.ceil((24*3600*1000 - (Date.now()-last))/1000);
    document.getElementById("msg").innerHTML = "الرجاء الانتظار " + remain + " ثانية";
    return;
  }

  spinning = true;
  document.getElementById("msg").innerHTML = "جاري الدوران...";

  const wheel = document.getElementById("wheel");

  const extra = 360 * 5; // 5 لفات كاملة
  const finalAngle = extra + (360 - HARD_LUCK_ANGLE);

  wheel.style.transform = `rotate(${finalAngle}deg)`;

  setTimeout(() => {
    document.getElementById("msg").innerHTML = "حظ أوفر، حاول غداً";
    setSpinTime();

    if (tg) {
      tg.sendData(JSON.stringify({
        prize: "HARD_LUCK",
        user_id
      }));
    }

    spinning = false;
  }, 4200);
};
</script>

</body>
</html>
